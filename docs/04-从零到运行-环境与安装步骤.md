# 从零到运行 — 环境配置与安装步骤

按「先环境、再后端、再前端」的顺序，一步一步从本机零环境跑到能打开登录页并调通接口。

---

## 一、本机需要提前装好的东西

| 项目 | 版本建议 | 用途 |
|------|----------|------|
| Python | 3.10 或 3.11 | 后端运行与依赖 |
| Node.js | 18+（建议 20+） | 前端构建与 dev 服务 |
| MySQL | 5.7+ 或 8.x | 后端主库（用户、题目、提交等） |
| Git | 任意 | 拉代码（若从仓库克隆） |

检查命令示例：

```bash
python --version   # 或 python3 --version
node --version
npm --version
mysql --version
```

---

## 二、拿到项目代码

- 若已有本地目录（如 `web_project`），直接进入即可。
- 若从 Git 克隆，例如：

```bash
git clone <你的仓库地址> web_project
cd web_project
```

目录结构应包含：

- `sql-edu-backend/`（后端）
- `sql-edu-frontend/`（前端）
- `docs/`（文档）

---

## 三、后端：从环境到跑起来

### 1. 进入后端目录

```bash
cd sql-edu-backend
```

### 2. 创建虚拟环境（推荐）

```bash
python -m venv .venv
```

激活：

- Windows（PowerShell）：`.venv\Scripts\Activate.ps1`
- Windows（CMD）：`.venv\Scripts\activate.bat`
- Linux / macOS：`source .venv/bin/activate`

激活后命令行前会出现 `(.venv)`。

### 3. 安装 Python 依赖

```bash
pip install -r requirements.txt
```

若网络慢，可加国内源，例如：

```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 4. 准备 MySQL 数据库

- 在 MySQL 里创建一个库，例如：`sql_edu`（名字自定，和下面连接串一致即可）。
- 记下：主机、端口、用户名、密码、库名。

### 5. 配置环境变量（.env）

在 `sql-edu-backend` 目录下新建 `.env` 文件（与 `main.py` 同级），内容示例：

```env
# 数据库（必填）：异步 MySQL 连接串
DB_URL=mysql+aiomysql://用户名:密码@127.0.0.1:3306/库名

# JWT（必填）：建议用随机字符串，例如：openssl rand -hex 32
SECRET_KEY=你的很长很随机的密钥
JWT_SECRET_KEY=你的JWT密钥

# 邮件（必填）：发验证码用
MAIL_USERNAME=你的邮箱
MAIL_PASSWORD=邮箱授权码或应用密码
MAIL_FROM=发件人邮箱
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=465

# AI（判题提示、对话、生成题目用；可不填则部分功能不可用）
AI_API_KEY=你的AI接口Key
AI_BASE_URL=AI接口地址，如 https://api.openai.com/v1
AI_MODEL_NAME=gpt-3.5-turbo
```

说明：

- `DB_URL`、`SECRET_KEY`、`JWT_SECRET_KEY`、邮件四项没有会报错。
- AI 不配则登录、题目列表仍可用，但提交判题、对话、AI 生成题目会报错或不可用。

### 6. 执行数据库迁移（建表）

```bash
alembic upgrade head
```

无报错即表示表结构已创建/更新。

### 7. 启动后端

```bash
uvicorn main:app --reload
```

默认地址：**http://127.0.0.1:8000**  
浏览器访问 http://127.0.0.1:8000 应看到：`{"message":"SQL 智能教学系统后端运行中"}`。

---

## 四、前端：从安装到跑起来

### 1. 打开新终端，进入前端目录

```bash
cd sql-edu-frontend
```

（若在项目根目录：`cd web_project/sql-edu-frontend`）

### 2. 安装前端依赖

```bash
npm install
```

若慢可用国内镜像，例如：

```bash
npm config set registry https://registry.npmmirror.com
npm install
```

### 3. 确认后端地址（开发环境）

前端开发时通过 Vite 代理访问后端，无需改代码即可用：

- 打开 `vite.config.ts`，确认 `server.proxy["/api"].target` 为你的后端地址，例如：

```ts
proxy: {
  "/api": {
    target: "http://127.0.0.1:8000",
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/api/, ""),
  },
},
```

后端若在本机 8000 端口，保持 `http://127.0.0.1:8000` 即可。

### 4. 启动前端开发服务

```bash
npm run dev:h5
```

终端会输出本地地址，例如：**http://localhost:5173**。用浏览器打开该地址。

### 5. 验证前后端是否通

- 打开登录页，能看见「登录 / 注册 / 注销账户」。
- 点击「获取验证码」，填邮箱后应能收到验证码（需邮件配置正确）。
- 注册或登录成功后，应跳转到学生练习页或教师端。

若请求失败，检查：

- 后端是否在 8000 端口运行；
- `vite.config.ts` 里 proxy 的 target 是否与后端一致；
- 浏览器控制台是否有跨域或 404（通常用代理后不会跨域）。

---

## 五、顺序小结（你要做的一步步）

| 步骤 | 做什么 | 在哪里 |
|------|--------|--------|
| 1 | 安装 Python、Node、MySQL | 本机 |
| 2 | 进入 `sql-edu-backend`，建虚拟环境并激活 | 后端目录 |
| 3 | `pip install -r requirements.txt` | 后端目录 |
| 4 | 在 MySQL 建库 | MySQL |
| 5 | 在 `sql-edu-backend` 下新建 `.env` 并填好 DB、JWT、邮件、AI | 后端目录 |
| 6 | `alembic upgrade head` | 后端目录 |
| 7 | `uvicorn main:app --reload` | 后端目录 |
| 8 | 新终端进入 `sql-edu-frontend`，`npm install` | 前端目录 |
| 9 | 确认 `vite.config.ts` 中 proxy 指向后端 | 前端目录 |
| 10 | `npm run dev:h5`，浏览器打开控制台给出的地址 | 前端目录 |

先保证后端能访问 http://127.0.0.1:8000，再跑前端并打开登录页，即完成「从环境配置到前后端都跑起来」的全流程。

---

## 六、常见问题

- **后端启动报错 `DB_URL` 未设置**  
  在 `sql-edu-backend` 下建 `.env`，并写 `DB_URL=mysql+aiomysql://...`。

- **alembic 报错找不到模块**  
  确保已在后端虚拟环境中：`pip install -r requirements.txt`，并在该环境中执行 `alembic upgrade head`。

- **前端请求 404 或连不上后端**  
  确认后端已启动在 8000 端口；确认 `vite.config.ts` 里 proxy 的 target 是 `http://127.0.0.1:8000`（或你实际使用的地址）。

- **收不到验证码邮件**  
  检查 `.env` 里 `MAIL_*` 配置；使用 Gmail 时需用「应用专用密码」而不是登录密码。

---

*文档与当前项目结构一致；若你使用 Conda 等其它环境，只需把「虚拟环境」那一步换成对应方式即可。*
